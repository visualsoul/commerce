{% extends "auctions/layout.html" %}
{% load static %}
{% block body %}
    <div class="row">
        <div style="width: 300px;margin-right: 120px; margin-bottom: 20px;" class="col col-3">
            <img style="max-height: 300px; max-width: 300px;" src="{{ listing.image_url }}" alt="{{ listing.title }}">
        </div>
        <div style="min-width: 400px; max-width: 500px;" class="col col-6">
            <strong>{{ listing.title }}</strong><br>
            Description: {{ listing.description }} <br>

            {% if user.username != listing.user.username %}
            Created on {{ listing.dt }} by {{ listing.user }}<br><br>
            {% else %}
            Created on {{ listing.dt }} by You<br><br>
            {% endif %}

            Starting Bid: ${{ listing.starting_bid }}<br>

            {% if current_price >= listing.starting_bid %}

                {% if listing.active %}
                Current Price: {{ current_price }} <br>
                    {% else %}
                Final Price: {{ current_price }} <br>
                    {% endif %}


                {% if current_bidder and listing.active %}
                    Current Bidder: {{ current_bidder }} <br><br>
                {% elif current_bidder and not listing.active %}
                    Winning Bidder: {{ current_bidder }} <br><br>
                {% else %}
                    <span>Item did not sell</span> <br><br>
                {% endif %}

            {% else %}
            Current Price: No bids<br>

            {% endif %}

        {% if user.is_authenticated %}
            {% if listing.active and user.username != listing.user.username %}
            <form action="" method="post">
                {% csrf_token %}
                {{ place_bid_form }}
                <input type="submit" name="place_bid" value="Submit Bid">
            </form>
            {% endif %}


                {% if watching == 0 %}
                <form action="" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="listing_id" value = "{{ listing.id }}">
                    <input class="btn btn-sm btn-warning" type="submit" name='create_watchlist_btn' value="Add to watchlist">
                </form>
                {% else %}
                    <form action="" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="listing_id" value = "{{ listing.id }}">
                    <input class="btn btn-sm btn-warning" type="submit" name='delete_watchlist_btn' value="Remove from watchlist">
                </form>
            {% endif %}

                {% if user.username == listing.user.username %}
                    <br>

                    {% if listing.active %}
                        <form action="" method="post">
                             {% csrf_token %}
                            <input class="btn btn-large btn-danger" type="submit" name="close_auction" value="Close">
                        </form>
                     {% else %}
                         <strong>- Listing Closed -</strong>
                     {% endif %}

                {% endif %}

            {% else %}
            <span>You need to <a href="{% url 'login' %}">Login</a> / <a href="{% url 'register' %}">Register</a> if you want to place a bid.</span>

        {% endif %}
        </div>


        <div class="col col-3">
            <form action="" method="post">
                {% csrf_token %}
                {{ comment_form }}
                <br>
                <input class="btn btn-small btn-primary" type="submit" name="submit_comment" value="Submit Comment">
            </form>
        </div>
    </div>
    <hr>
    <div class="row">
       <div class="col col-6">
           <div>
               <h2>Comments</h2>

                   {% if comments %}
                   {% for comment in comments %}
                     <div class="container">
                     <span>{{ comment.user.username }}</span><br>
                     <span>{{ comment.message }}</span><br>
                     Posted on <span>{{ comment.dt }}</span>
                         <hr>
                     </div>
                   {% endfor %}
                   {% endif %}

           </div>
       </div>
    </div>


{% endblock %}